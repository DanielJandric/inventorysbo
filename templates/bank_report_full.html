<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Famille Bonvin Family Office – Rapport Bancaire Complet</title>
  <style>
    body { font-family: Arial, sans-serif; color:#111827; }
    .cover { text-align:center; padding: 40px 0; }
    .muted { color:#6b7280; }
    .kpi-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:12px; margin:16px 0 24px; }
    .kpi { border:1px solid #e5e7eb; border-radius:6px; padding:12px; background:#f9fafb; }
    .kpi .v { font-weight:700; font-size:16px; }
    .section { margin: 20px 0; }
    .section-title { font-weight:700; font-size:16px; border-bottom:1px solid #e5e7eb; padding-bottom:6px; margin-bottom:10px; }
    .sub-title { font-weight:600; font-size:14px; margin:8px 0; color:#374151; }
    table { width:100%; border-collapse:collapse; font-size:11px; table-layout: fixed; }
    th, td { border:1px solid #e5e7eb; padding:5px 6px; text-align:left; vertical-align:top; overflow:hidden; word-wrap:break-word; }
    th { background:#f3f4f6; text-transform:uppercase; font-size:11px; }
    .two-col { display:grid; grid-template-columns: 1fr 1fr; gap:18px; }
    .badge { padding:2px 6px; border-radius:4px; font-size:11px; }
    .badge-sale { background:#fee2e2; color:#b91c1c; border:1px solid #fecaca; }
  </style>
  </head>
  <body>
    <div class="cover">
      <h1>Famille Bonvin Family Office – Rapport Bancaire Complet</h1>
      <div class="muted">Généré le {{ generation_date }}</div>
    </div>

    <div class="kpi-grid">
      <div class="kpi"><div class="t muted">Nombre total d'objets</div><div class="v">{{ total_items }}</div></div>
      <div class="kpi"><div class="t muted">Disponibles</div><div class="v">{{ available_count }}</div></div>
      <div class="kpi"><div class="t muted">Vendus</div><div class="v">{{ sold_count }}</div></div>
      <div class="kpi"><div class="t muted">Valeur (disponible)</div><div class="v">{{ total_value_available }}</div></div>
      <div class="kpi"><div class="t muted">Valeur (totale)</div><div class="v">{{ total_value_all }}</div></div>
    </div>

    <div class="section">
      <div class="section-title">Résumé par classe bancaire</div>
      <table>
        <thead>
          <tr><th>Classe</th><th>Nb actifs</th><th>Nb disponibles</th><th>Valeur dispo</th><th>Valeur totale</th></tr>
        </thead>
        <tbody>
        {% for cls, s in classes_summary.items() %}
          <tr>
            <td>{{ cls }}</td>
            <td>{{ s.count_all }}</td>
            <td>{{ s.count_available }}</td>
            <td>{{ s.value_available }}</td>
            <td>{{ s.value_all }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    {% for cls, submap in assets_by_class.items() %}
      <div class="section">
        <div class="section-title">{{ cls }}</div>
        {% for sub, assets in submap.items() %}
          <div class="sub-title">{{ sub }}</div>
          <div class="two-col">
            <div>
              <h4 class="sub-title" style="margin-top:0">Actifs Disponibles</h4>
              <table>
                <thead>
                  <tr>
                    <th style="width:18%">Nom</th>
                    <th style="width:10%">Catégorie</th>
                    <th style="width:10%">Symbole</th>
                    <th style="width:7%">Qté</th>
                    <th style="width:10%">Prix</th>
                    <th style="width:7%">Devise</th>
                    <th style="width:12%">Valeur</th>
                    <th style="width:12%">MAJ</th>
                    <th style="width:7%">52W H</th>
                    <th style="width:7%">52W L</th>
                  </tr>
                </thead>
                <tbody>
                  {% for a in assets if a.status == 'Available' %}
                    <tr>
                      <td>
                        {{ a.name }}
                        {% if a.for_sale %}
                          <span class="badge badge-sale">EN VENTE {{ a.sale_status or '' }}</span>
                        {% endif %}
                      </td>
                      <td>{{ a.category }}</td>
                      <td>{{ a.symbol or '-' }}</td>
                      <td>{{ a.quantity or '-' }}</td>
                      <td>{{ a.unit_price or '-' }}</td>
                      <td>{{ a.currency or '-' }}</td>
                      <td>{{ a.value }}</td>
                      <td>{{ a.last_update or '-' }}</td>
                      <td>{{ a.wk52_high or '-' }}</td>
                      <td>{{ a.wk52_low or '-' }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div>
              <h4 class="sub-title" style="margin-top:0">Actifs Vendus</h4>
              <table>
                <thead>
                  <tr>
                    <th style="width:25%">Nom</th>
                    <th style="width:14%">Catégorie</th>
                    <th style="width:12%">Symbole</th>
                    <th style="width:8%">Qté</th>
                    <th style="width:10%">Prix</th>
                    <th style="width:8%">Devise</th>
                    <th style="width:12%">Valeur</th>
                    <th style="width:6%">Année</th>
                    <th style="width:5%">État</th>
                  </tr>
                </thead>
                <tbody>
                  {% for a in assets if a.status == 'Sold' %}
                    <tr>
                      <td>{{ a.name }}</td>
                      <td>{{ a.category }}</td>
                      <td>{{ a.symbol or '-' }}</td>
                      <td>{{ a.quantity or '-' }}</td>
                      <td>{{ a.unit_price or '-' }}</td>
                      <td>{{ a.currency or '-' }}</td>
                      <td>{{ a.value }}</td>
                      <td>{{ a.construction_year or '-' }}</td>
                      <td>{{ a.condition or '-' }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </body>
  </html>


